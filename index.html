<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://pic3.zhimg.com/v2-7ccb1fc2625f8f8d2927a0371f3af244_720w.jpg?source=172ae18b">
    <title>2048 | 标准模式 | 中等 | 4×4 | 分数: 0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet" crossorigin="anonymous">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#faa31b',
                        secondary: '#8f7a66',
                        bg: '#faf8ef',
                        grid: '#bbada0',
                        cellEmpty: '#cdc1b4',
                        easy: '#4CAF50',
                        medium: '#FFC107',
                        hard: '#F44336',
                        dark: {
                            bg: '#121212',
                            surface: '#1e1e1e',
                            primary: '#ffb74d',
                            secondary: '#a1887f',
                            grid: '#37474f',
                            cellEmpty: '#546e7a',
                            text: '#e0e0e0',
                            muted: '#9e9e9e',
                        }
                    },
                    fontFamily: {
                        game: ['"Clear Sans"', 'Helvetica Neue', 'Arial', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <script>
        const themeToggle = document.getElementById('theme-toggle');
        if (themeToggle) {
            const isDarkMode = document.documentElement.classList.contains('dark');
            themeToggle.value = isDarkMode ? 'dark' : 'light';
        }
    </script>
    <style type="text/tailwindcss">
        .hidden { opacity: 0; visibility: hidden; transition: all 0.3s ease; } .modal-enter { opacity: 0; transform: scale(0.95); } .modal-enter-active { opacity: 1; transform: scale(1); transition: opacity 0.3s ease, transform 0.3s ease; } .modal-exit { opacity: 1; transform: scale(1); } .modal-exit-active { opacity: 0; transform: scale(0.95); transition: opacity 0.3s ease, transform 0.3s ease; } :host, html { -webkit-text-size-adjust: 100%; -moz-text-size-adjust: 100%; text-size-adjust: 100%; }
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .tile-2 { background-color: #eee4da; color: #776e65; }
            .tile-4 { background-color: #ede0c8; color: #776e65; }
            .tile-8 { background-color: #f2b179; color: #f9f6f2; }
            .tile-16 { background-color: #f59563; color: #f9f6f2; }
            .tile-32 { background-color: #f67c5f; color: #f9f6f2; }
            .tile-64 { background-color: #f65e3b; color: #f9f6f2; }
            .tile-128 { background-color: #edcf72; color: #f9f6f2; }
            .tile-256 { background-color: #edcc61; color: #f9f6f2; }
            .tile-512 { background-color: #edc850; color: #f9f6f2; }
            .tile-1024 { background-color: #edc53f; color: #f9f6f2; }
            .tile-2048 { background-color: #edc22e; color: #f9f6f2; }
            .tile-4096 { background-color: #e65100; color: #ffffff; }
            .tile-8192 { background-color: #bf360c; color: #ffffff; }
            .tile-16384 { background-color: #880e4f; color: #ffffff; }
            .tile-32768 { background-color: #4a148c; color: #ffffff; }
            .tile-super { background-color: #311b92; color: #ffffff; }
            .tile.gpu-accelerated { transform: translateZ(0); will-change: transform; }
            .dark .tile-2 { background-color: #424242; color: #e0e0e0; }
            .dark .tile-4 { background-color: #546e7a; color: #e0e0e0; }
            .dark .tile-8 { background-color: #ff8a65; color: #212121; }
            .dark .tile-16 { background-color: #ff7043; color: #212121; }
            .dark .tile-32 { background-color: #ff5722; color: #212121; }
            .dark .tile-64 { background-color: #f4511e; color: #212121; }
            .dark .tile-128 { background-color: #ffca28; color: #212121; }
            .dark .tile-256 { background-color: #ffc107; color: #212121; }
            .dark .tile-512 { background-color: #ffb300; color: #212121; }
            .dark .tile-1024 { background-color: #ffa000; color: #212121; }
            .dark .tile-2048 { background-color: #ff8f00; color: #212121; }
            .dark .tile-4096 { background-color: #e65100; color: #ffffff; }
            .dark .tile-8192 { background-color: #c62828; color: #ffffff; }
            .dark .tile-16384 { background-color: #ad1457; color: #ffffff; }
            .dark .tile-32768 { background-color: #6a1b9a; color: #ffffff; }
            .dark .tile-super { background-color: #4527a0; color: #ffffff; }
            .tile-appear {
                animation: appear 200ms ease-in-out;
            }
            .tile-merge {
                animation: merge 200ms ease-in-out;
            }
            @keyframes appear {
                0% { transform: scale(0.8); opacity: 0.8; }
                100% { transform: scale(1); opacity: 1; }
            }
            @keyframes merge {
                0% { transform: scale(1); }
                50% { transform: scale(1.2); }
                100% { transform: scale(1); }
            }
            .game-container {
                position: relative;
                padding: 16px;
                cursor: default;
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                -khtml-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
                background: #bbada0;
                border-radius: 12px;
                width: 90vw;
                height: 90vw;
                max-width: 500px;
                max-height: 500px;
                -webkit-box-sizing: border-box;
                -moz-box-sizing: border-box;
                box-sizing: border-box;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
                margin: 0 auto;
                transition: background-color 0.3s ease;
            }
            .dark .game-container {
                background: #37474f;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            }
            .grid-container {
                position: absolute;
                z-index: 1;
                width: calc(100% - 32px);
                height: calc(100% - 32px);
            }
            .grid-row {
                display: flex;
                margin-bottom: 16px;
            }
            .grid-cell {
                margin-right: 16px;
                border-radius: 6px;
                background: rgba(238, 228, 218, 0.35);
                transition: background-color 0.3s ease;
            }
            .dark .grid-cell {
                background: rgba(84, 110, 122, 0.35);
            }
            .grid-cell:last-child {
                margin-right: 0;
            }
            .tile-container {
                position: absolute;
                z-index: 2;
                width: calc(100% - 32px);
                height: calc(100% - 32px);
            }
            .tile {
                position: absolute;
                border-radius: 6px;
                font-weight: bold;
                text-align: center;
                transition: 100ms ease-in-out;
                transition-property: transform, left, top;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                display: flex;
                align-items: center;
                justify-content: center;
                will-change: transform, left, top;
                transition: all 0.3s ease;
                font-size: clamp(1rem, 5vw, 2.5rem);
            }
            #theme-toggle, #theme-toggle option {
                font-family: 'Font Awesome 6 Free', sans-serif !important;
                font-weight: 900 !important;
                background-color: theme('colors.bg');
                color: theme('colors.secondary');
                border: 2px solid theme('colors.grid');
                padding: 0.5rem 2.5rem 0.5rem 1rem;
                border-radius: 8px;
                appearance: none;
                background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' class='h-5 w-5' viewBox='0 0 20 20' fill='%238f7a66'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd'/%3E%3C/svg%3E");
                background-repeat: no-repeat;
                background-position: right 0.7rem center;
                background-size: 1.2em;
                transition: all 0.2s ease;
            }
            #theme-toggle:hover {
                border-color: theme('colors.primary');
                box-shadow: 0 0 0 2px rgba(250, 163, 27, 0.2);
            }
            #theme-toggle:focus {
                outline: none;
                --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);
                --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) rgba(250, 163, 27, 0.5);
                box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000);
            }
            .dark #theme-toggle, .dark #theme-toggle option {
                background-color: theme('colors.dark.surface');
                color: theme('colors.dark.text');
                border-color: theme('colors.dark.grid');
                background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' class='h-5 w-5' viewBox='0 0 20 20' fill='%23e0e0e0'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd'/%3E%3C/svg%3E");
            }
            .dark #theme-toggle:hover {
                border-color: theme('colors.dark.primary');
            }
            .grid-3x3 .grid-row {
                height: calc((100% - 32px) / 3);
            }
            .grid-3x3 .grid-cell {
                width: calc((100% - 32px) / 3);
            }
            .grid-3x3 .tile {
                width: calc((100% - 32px) / 3);
                height: calc((100% - 32px) / 3);
            }
            .grid-4x4 .grid-row {
                height: calc((100% - 48px) / 4);
            }
            .grid-4x4 .grid-cell {
                width: calc((100% - 48px) / 4);
            }
            .grid-4x4 .tile {
                width: calc((100% - 48px) / 4);
                height: calc((100% - 48px) / 4);
            }
            .grid-5x5 .grid-row {
                height: calc((100% - 64px) / 5);
            }
            .grid-5x5 .grid-cell {
                width: calc((100% - 64px) / 5);
            }
            .grid-5x5 .tile {
                width: calc((100% - 64px) / 5);
                height: calc((100% - 64px) / 5);
                font-size: clamp(0.8rem, 3vw, 2rem);
            }
            .grid-5x5 .tile-5digit {
                font-size: clamp(0.8rem, 2.2vw, 1.6rem);
            }
            .grid-4x4 .tile-5digit {
                font-size: clamp(1rem, 3vw, 2rem);
            }
            .grid-3x3 .tile[data-pos="0-0"] { left: 0%; top: 0%; }
            .grid-3x3 .tile[data-pos="1-0"] { left: calc(33.333% + 5.333px); top: 0%; }
            .grid-3x3 .tile[data-pos="2-0"] { left: calc(66.666% + 10.666px); top: 0%; }
            .grid-3x3 .tile[data-pos="0-1"] { left: 0%; top: calc(33.333% + 5.333px); }
            .grid-3x3 .tile[data-pos="1-1"] { left: calc(33.333% + 5.333px); top: calc(33.333% + 5.333px); }
            .grid-3x3 .tile[data-pos="2-1"] { left: calc(66.666% + 10.666px); top: calc(33.333% + 5.333px); }
            .grid-3x3 .tile[data-pos="0-2"] { left: 0%; top: calc(66.666% + 10.666px); }
            .grid-3x3 .tile[data-pos="1-2"] { left: calc(33.333% + 5.333px); top: calc(66.666% + 10.666px); }
            .grid-3x3 .tile[data-pos="2-2"] { left: calc(66.666% + 10.666px); top: calc(66.666% + 10.666px); }
            .grid-4x4 .tile[data-pos="0-0"] { left: 0%; top: 0%; }
            .grid-4x4 .tile[data-pos="1-0"] { left: calc(25% + 4px); top: 0%; }
            .grid-4x4 .tile[data-pos="2-0"] { left: calc(50% + 8px); top: 0%; }
            .grid-4x4 .tile[data-pos="3-0"] { left: calc(75% + 12px); top: 0%; }
            .grid-4x4 .tile[data-pos="0-1"] { left: 0%; top: calc(25% + 4px); }
            .grid-4x4 .tile[data-pos="1-1"] { left: calc(25% + 4px); top: calc(25% + 4px); }
            .grid-4x4 .tile[data-pos="2-1"] { left: calc(50% + 8px); top: calc(25% + 4px); }
            .grid-4x4 .tile[data-pos="3-1"] { left: calc(75% + 12px); top: calc(25% + 4px); }
            .grid-4x4 .tile[data-pos="0-2"] { left: 0%; top: calc(50% + 8px); }
            .grid-4x4 .tile[data-pos="1-2"] { left: calc(25% + 4px); top: calc(50% + 8px); }
            .grid-4x4 .tile[data-pos="2-2"] { left: calc(50% + 8px); top: calc(50% + 8px); }
            .grid-4x4 .tile[data-pos="3-2"] { left: calc(75% + 12px); top: calc(50% + 8px); }
            .grid-4x4 .tile[data-pos="0-3"] { left: 0%; top: calc(75% + 12px); }
            .grid-4x4 .tile[data-pos="1-3"] { left: calc(25% + 4px); top: calc(75% + 12px); }
            .grid-4x4 .tile[data-pos="2-3"] { left: calc(50% + 8px); top: calc(75% + 12px); }
            .grid-4x4 .tile[data-pos="3-3"] { left: calc(75% + 12px); top: calc(75% + 12px); }
            .grid-5x5 .tile[data-pos="0-0"] { left: 0%; top: 0%; }
            .grid-5x5 .tile[data-pos="1-0"] { left: calc(20% + 3.2px); top: 0%; }
            .grid-5x5 .tile[data-pos="2-0"] { left: calc(40% + 6.4px); top: 0%; }
            .grid-5x5 .tile[data-pos="3-0"] { left: calc(60% + 9.6px); top: 0%; }
            .grid-5x5 .tile[data-pos="4-0"] { left: calc(80% + 12.8px); top: 0%; }
            .grid-5x5 .tile[data-pos="0-1"] { left: 0%; top: calc(20% + 3.2px); }
            .grid-5x5 .tile[data-pos="1-1"] { left: calc(20% + 3.2px); top: calc(20% + 3.2px); }
            .grid-5x5 .tile[data-pos="2-1"] { left: calc(40% + 6.4px); top: calc(20% + 3.2px); }
            .grid-5x5 .tile[data-pos="3-1"] { left: calc(60% + 9.6px); top: calc(20% + 3.2px); }
            .grid-5x5 .tile[data-pos="4-1"] { left: calc(80% + 12.8px); top: calc(20% + 3.2px); }
            .grid-5x5 .tile[data-pos="0-2"] { left: 0%; top: calc(40% + 6.4px); }
            .grid-5x5 .tile[data-pos="1-2"] { left: calc(20% + 3.2px); top: calc(40% + 6.4px); }
            .grid-5x5 .tile[data-pos="2-2"] { left: calc(40% + 6.4px); top: calc(40% + 6.4px); }
            .grid-5x5 .tile[data-pos="3-2"] { left: calc(60% + 9.6px); top: calc(40% + 6.4px); }
            .grid-5x5 .tile[data-pos="4-2"] { left: calc(80% + 12.8px); top: calc(40% + 6.4px); }
            .grid-5x5 .tile[data-pos="0-3"] { left: 0%; top: calc(60% + 9.6px); }
            .grid-5x5 .tile[data-pos="1-3"] { left: calc(20% + 3.2px); top: calc(60% + 9.6px); }
            .grid-5x5 .tile[data-pos="2-3"] { left: calc(40% + 6.4px); top: calc(60% + 9.6px); }
            .grid-5x5 .tile[data-pos="3-3"] { left: calc(60% + 9.6px); top: calc(60% + 9.6px); }
            .grid-5x5 .tile[data-pos="4-3"] { left: calc(80% + 12.8px); top: calc(60% + 9.6px); }
            .grid-5x5 .tile[data-pos="0-4"] { left: 0%; top: calc(80% + 12.8px); }
            .grid-5x5 .tile[data-pos="1-4"] { left: calc(20% + 3.2px); top: calc(80% + 12.8px); }
            .grid-5x5 .tile[data-pos="2-4"] { left: calc(40% + 6.4px); top: calc(80% + 12.8px); }
            .grid-5x5 .tile[data-pos="3-4"] { left: calc(60% + 9.6px); top: calc(80% + 12.8px); }
            .grid-5x5 .tile[data-pos="4-4"] { left: calc(80% + 12.8px); top: calc(80% + 12.8px); }
            .btn-hover {
                transition: all 0.2s ease;
            }
            .btn-hover:hover {
                transform: translateY(-2px);
            }
            .btn-hover:active {
                transform: translateY(0);
            }
            .modal-enter {
                opacity: 0;
                transform: scale(0.95);
            }
            .modal-enter-active {
                opacity: 1;
                transform: scale(1);
                transition: opacity 200ms, transform 200ms;
            }
            .modal-exit {
                opacity: 1;
            }
            .modal-exit-active {
                opacity: 0;
                transition: opacity 200ms;
            }
            .dark .bg-bg {
                background-color: theme('colors.dark.bg');
            }
            .dark .text-secondary {
                color: theme('colors.dark.text');
            }
            .dark .text-secondary\/80 {
                color: theme('colors.dark.muted');
            }
            .dark .bg-grid {
                background-color: theme('colors.dark.grid');
            }
            .dark .bg-primary {
                background-color: #ff8f00;
            }
            .dark #resume-button { background-color: #ff8f00; }
            .dark #resume-button:hover { background-color: #e65100; }
            .dark .bg-secondary {
                background-color: #4527a0;
            }
            .dark #new-game { background-color: #ff8f00; }
            .dark #endless-mode { background-color: #4527a0; }
            .dark #new-game:hover { background-color: #e65100; }
            .dark #endless-mode:hover { background-color: #311b92; }
            .dark .bg-easy {
                background-color: theme('colors.easy');
            }
            .dark .bg-medium {
                background-color: theme('colors.medium');
            }
            .dark .bg-hard {
                background-color: theme('colors.hard');
            }
            .dark #grid-3x3 { background-color: #2e7d32; }
            .dark #grid-4x4 { background-color: #1565c0; }
            .dark #grid-5x5 { background-color: #6a1b9a; }
            .dark #grid-3x3:hover { background-color: #1b5e20; }
            .dark #grid-4x4:hover { background-color: #0d47a1; }
            .dark #grid-5x5:hover { background-color: #4a148c; }
            .dark .bg-easy { background-color: #2e7d32; }
            .dark .bg-medium { background-color: #ff8f00; }
            .dark .bg-hard { background-color: #c62828; }
            .dark .bg-easy:hover { background-color: #1b5e20; }
            .dark .bg-medium:hover { background-color: #e65100; }
            .dark .bg-hard:hover { background-color: #b71c1c; }
            .dark .ring-easy {
                --tw-ring-color: theme('colors.easy');
            }
            .dark .ring-medium {
                --tw-ring-color: theme('colors.medium');
            }
            .dark .ring-hard {
                --tw-ring-color: theme('colors.hard');
            }
            .dark .bg-white {
                background-color: theme('colors.dark.surface');
            }
            .dark .text-white {
                color: theme('colors.dark.text');
            }
            .dark .text-white\/70 {
                color: theme('colors.dark.muted');
            }
            .dark .focus:ring-primary\/50 {
                --tw-ring-color: theme('colors.dark.primary');
            }
            .dark .focus:ring-easy\/50 {
                --tw-ring-color: theme('colors.easy');
            }
            .dark .focus:ring-medium\/50 {
                --tw-ring-color: theme('colors.medium');
            }
            .dark .focus:ring-hard\/50 {
                --tw-ring-color: theme('colors.hard');
            }
            .dark .btn-hover {
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            }
            .dark .game-message {
                background-color: rgba(0, 0, 0, 0.7);
            }
            .compact-header {
                flex-direction: column !important;
                align-items: flex-start !important;
            }
            .compact-title, .compact-description, .compact-buttons {
                text-align: left !important;
                justify-content: flex-start !important;
            }
            .compact-title {
                font-size: clamp(2rem, 8vw, 3rem) !important;
            }
            .compact-stats {
                flex-direction: column !important;
                gap: 0.5rem !important;
                margin-top: 1rem !important;
                width: 100% !important;
            }
            .compact-stats .bg-grid {
                padding: 0.5rem !important;
            }
            .compact-stats .text-xs {
                font-size: 0.65rem !important;
            }
            .compact-stats .text-xl {
                font-size: 1.25rem !important;
            }
            .compact-buttons {
                flex-direction: column !important;
                gap: 0.5rem !important;
            }
            .compact-buttons button {
                padding: 0.75rem !important;
                font-size: 0.9rem !important;
            }
            .compact-difficulty {
                gap: 0.5rem !important;
            }
            .compact-difficulty button {
                padding: 0.5rem !important;
                font-size: 0.85rem !important;
            }
            .compact-description {
                font-size: 0.8rem !important;
            }
            .compact-message .bg-white {
                padding: 1.5rem !important;
                max-width: 85% !important;
            }
            .compact-message h2 {
                font-size: 1.5rem !important;
            }
            .compact-message button {
                padding: 0.75rem !important;
                font-size: 0.9rem !important;
            }
            .markdown-content h1 {
                font-size: 1.75rem;
                font-weight: bold;
                margin-bottom: 1rem;
                color: theme('colors.primary');
            }
            .markdown-content h2 {
                font-size: 1.5rem;
                font-weight: bold;
                margin-top: 1.5rem;
                margin-bottom: 0.75rem;
                color: theme('colors.secondary');
            }
            .markdown-content h3 {
                font-size: 1.25rem;
                font-weight: bold;
                margin-top: 1rem;
                margin-bottom: 0.5rem;
            }
            .markdown-content p {
                margin-bottom: 1rem;
                line-height: 1.5;
            }
            .markdown-content ul {
                list-style-type: disc;
                padding-left: 1.5rem;
                margin-bottom: 1rem;
            }
            .markdown-content ol {
                list-style-type: decimal;
                padding-left: 1.5rem;
                margin-bottom: 1rem;
            }
            .markdown-content li {
                margin-bottom: 0.5rem;
            }
            .markdown-content a {
                color: theme('colors.primary');
                text-decoration: underline;
            }
            .markdown-content a:hover {
                text-decoration: none;
            }
            .markdown-content strong {
                font-weight: bold;
            }
            .markdown-content em {
                font-style: italic;
            }
            .markdown-content code {
                background-color: rgba(0, 0, 0, 0.05);
                padding: 0.2rem 0.4rem;
                border-radius: 4px;
                font-family: monospace;
            }
            .dark .markdown-content code {
                background-color: rgba(255, 255, 255, 0.1);
            }
            .markdown-content blockquote {
                border-left: 4px solid theme('colors.primary');
                padding-left: 1rem;
                margin-left: 0;
                margin-bottom: 1rem;
                color: theme('colors.secondary/80');
            }
            .dark .markdown-content blockquote {
                color: theme('colors.dark.text');
            }
            .dark .markdown-content {
                color: theme('colors.dark.text');
            }
            .markdown-content hr {
                border: 0;
                border-top: 1px solid theme('colors.secondary/20');
                margin: 1.5rem 0;
            }
            .dark .markdown-content hr {
                border-top: 1px solid theme('colors.dark.muted/20');
            }
            .markdown-content .emoji {
                font-family: 'Apple Color Emoji', 'Segoe UI Emoji', 'NotoColorEmoji', 'Segoe UI Symbol', 'Android Emoji', 'EmojiSymbols';
            }
            .options-container {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
                margin-bottom: 1rem;
            }
            .options-row {
                display: flex;
                flex-wrap: wrap;
                gap: 0.5rem;
                align-items: center;
            }
            .option-label {
                font-size: 0.85rem;
                color: theme('colors.secondary/80');
                white-space: nowrap;
                flex-shrink: 0;
            }
            .dark .option-label {
                color: theme('colors.dark.muted');
            }
            .option-buttons {
                display: flex;
                flex-wrap: wrap;
                gap: 0.5rem;
                flex: 1;
            }
            @media (max-width: 400px) {
                .options-row {
                    flex-direction: column;
                    align-items: flex-start;
                }
                .option-label {
                    margin-bottom: 0.25rem;
                }
                .option-buttons {
                    width: 100%;
                }
            }
            @media (max-width: 770px) {
                #game-header {
                    @apply compact-header;
                }
                #game-title {
                    @apply compact-title;
                }
                #game-header p {
                    @apply compact-description;
                }
            }
        }
        @media (max-width: 180px) {
            .button-text {
                display: none;
            }
            #undo-button .mr-1, #pause-button .mr-1 {
                margin-right: 0 !important;
            }
        }
        @media (max-width: 120px) {
            .prefix-text, .mode-text { display: none; }
            .icon-margin { margin-right: 0; }
        }
        @media (max-width: 140px) {
            .mode-text {
                display: none;
            }
            #new-game .mr-2, #endless-mode .mr-2 {
                margin-right: 0.5rem !important;
            }
        }
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #bbb;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #999;
        }
        .dark ::-webkit-scrollbar-track {
            background: #333;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #666;
        }
        .dark ::-webkit-scrollbar-thumb:hover {
            background: #888;
        }
        .dark .setting-label {
            color: #e0e0e0;
        }
        @media (max-width: 200px){
            .hide-small{
                display:none;
            }
        }
        @media (max-width: 170px){
            .settings-text{
                display:none;
            }
            #close-settings-button{
                right: 15px;
            }
        }
        @media (max-width: 220px) {
            #close-ai-modal {
                right: 0.5rem !important;
            }
        }
        @media (max-width: 190px) {
            #close-ai-modal {
                right: 0 !important;
            }
        }
        @media (max-width: 160px){
            .text-content{
                display:none;
            }
        }
        .ai-analysis-modal {
            position: fixed;top: 0;left: 0;right: 0;bottom: 0;background: rgba(0,0,0,0.5);display: flex;align-items: center;justify-content: center;z-index: 1000; opacity: 0; transform: scale(0.9); visibility: hidden; transition: opacity 0.3s ease, transform 0.3s ease, visibility 0.3s ease; 
        }
        .dark .ai-analysis-modal {
            background: rgba(0,0,0,0.7);
        }
        .ai-analysis-modal:not(.hidden) {
            opacity: 1; transform: scale(1); visibility: visible; 
        }
        .ai-analysis-content {
            background: white;padding: 20px;border-radius: 8px;max-width: 500px;width: 90%;max-height: 80vh;overflow-y: auto;
        }
        .dark .ai-analysis-content {
            background: #2d3748;color: white;
        }
        .ai-analysis-title {
            font-size: 18px;font-weight: bold;margin-bottom: 15px;padding-bottom: 10px;border-bottom: 1px solid #eee;position: relative;
        }
        .dark .ai-analysis-title {
            border-bottom: 1px solid #4a5568;
        }
        .analysis-item {
            margin-bottom: 15px;
        }
        .analysis-label {
            font-weight: bold;margin-bottom: 5px;color: #666;
        }
        .dark .analysis-label {
            color: #a0aec0;
        }
        .analysis-value {
            padding: 8px 12px;background: #f5f5f5;border-radius: 4px;
        }
        .dark .analysis-value {
            background: #4a5568;
        }
        .best-move {
            background: #e8f5e9;color: #2e7d32;font-weight: bold;
        }
        .dark .best-move {
            background: #48bb78;color: #f0fff4;
        }
        #game-state-assessment {
            font-weight: bold;
        }
        #game-state-assessment.good {
            background: #e8f5e9;color: #2e7d32;
        }
        .dark #game-state-assessment.good {
            background: #48bb78;color: #f0fff4;
        }
        #game-state-assessment.average {
            background: #fff8e1;color: #ff8f00;
        }
        .dark #game-state-assessment.average {
            background: #ffd54f;color: #3e2723;
        }
        #game-state-assessment.danger {
            background: #ffebee;color: #c62828;
        }
        .dark #game-state-assessment.danger {
            background: #e57373;color: #ffebee;
        }
        #merge-opportunities {
            font-weight: bold;
        }
        #merge-opportunities.high {
            background: #e8f5e9;color: #2e7d32;
        }
        .dark #merge-opportunities.high {
            background: #48bb78;color: #f0fff4;
        }
        #merge-opportunities.medium {
            background: #fff8e1;color: #ff8f00;
        }
        .dark #merge-opportunities.medium {
            background: #ffd54f;color: #3e2723;
        }
        #merge-opportunities.low {
            background: #ffebee;color: #c62828;
        }
        .dark #merge-opportunities.low {
            background: #e57373;color: #ffebee;
        }
        #score-potential {
            font-weight: bold;
        }
        #score-potential.high {
            background: #e8f5e9;color: #2e7d32;
        }
        .dark #score-potential.high {
            background: #48bb78;color: #f0fff4;
        }
        #score-potential.medium {
            background: #fff8e1;color: #ff8f00;
        }
        .dark #score-potential.medium {
            background: #ffd54f;color: #3e2723;
        }
        #score-potential.low {
            background: #ffebee;color: #c62828;
        }
        .dark #score-potential.low {
            background: #e57373;color: #ffebee;
        }
    </style>
</head>
<body class="bg-bg font-game min-h-screen flex flex-col items-center justify-center p-4 transition-colors duration-300">
    <div class="max-w-md w-full mx-auto">
        <header id="game-header" class="flex flex-col md:flex-row justify-between items-center mb-6">
            <div>
                <h1 id="game-title" class="text-[clamp(2.5rem,5vw,3.5rem)] font-bold text-secondary dark:text-dark-text mb-1 tracking-tight">2048</h1>
                <p class="text-[clamp(1rem,2vw,1.2rem)] text-secondary/80 dark:text-dark-muted">滑动合并方块，创建<span class="font-bold">2048</span>！</p>
            </div>
        <style>
            .custom-select {position: relative;}
            .select-selected {user-select: none;}.select-selected i {transition: transform 0.3s ease;}.select-selected.active i {transform: rotate(180deg);}
            .select-items {user-select: none; overflow-y: auto; max-height: 200px;}
            .select-item {display: flex;align-items: center;font-family: 'Font Awesome 6 Free', sans-serif;font-weight: 900;}.select-item.selected { background-color: #d1d5db; } .dark .select-item.selected { background-color: #4b5563; }.selected-value {font-family: 'Font Awesome 6 Free', sans-serif;font-weight: 900;}
        </style>
            <div class="flex gap-2 mt-4 md:mt-0">
                <button id="undo-button" class="bg-grid hover:bg-grid/80 text-white p-2 rounded-md shadow-md transition-all duration-200 transform hover:scale-105 focus:outline-none dark:bg-dark-grid" title="撤销上一步">
                    <i class="fa-solid fa-undo mr-1"></i><span class="button-text">撤销</span>
                </button>
                <button id="pause-button" class="bg-grid hover:bg-grid/80 text-white p-2 rounded-md shadow-md transition-all duration-200 transform hover:scale-105 focus:outline-none dark:bg-dark-grid" title="暂停游戏">
                    <i class="fa-solid fa-pause mr-1"></i><span class="button-text">暂停</span>
                </button>
            </div>
        </header>
        <div id="game-buttons" class="flex flex-wrap gap-2 mb-4">
            <button id="new-game" class="bg-primary hover:bg-primary/90 text-white font-bold py-3 px-6 rounded-md shadow-md transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary/50 flex-1 btn-hover dark:bg-dark-primary">
                <i class="fa-solid fa-gamepad mr-2"></i><span class="prefix-text">标准</span><span class="mode-text">模式</span>
            </button>
            <button id="endless-mode" class="bg-secondary hover:bg-secondary/90 text-white font-bold py-3 px-6 rounded-md shadow-md transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-secondary/50 flex-1 btn-hover dark:bg-dark-secondary">
                <i class="fa-solid fa-infinity mr-2"></i><span class="prefix-text">无尽</span><span class="mode-text">模式</span>
            </button>
        </div>
        <div class="options-container mb-4">
            <div class="options-row">
                <span class="option-label">网格大小:</span>
                <div class="option-buttons">
                    <button id="grid-3x3" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md shadow-md transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-300 btn-hover">
                        <i class="fa-solid fa-square-three"></i>3×3
                    </button>
                    <button id="grid-4x4" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md shadow-md transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-300 btn-hover active">
                        <i class="fa-solid fa-square-four"></i>4×4
                    </button>
                    <button id="grid-5x5" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-md shadow-md transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-300 btn-hover">
                        <i class="fa-solid fa-square-five"></i>5×5
                    </button>
                </div>
            </div>
            <div class="options-row">
                <span class="option-label">难度选择:</span>
                <div class="option-buttons">
                    <button id="easy-mode" class="bg-easy hover:bg-easy/90 text-white font-bold py-2 px-4 rounded-md shadow-md transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-easy/50 flex-1 btn-hover">
                        <i class="fa-solid fa-shield-check mr-2"></i>简单
                    </button>
                    <button id="medium-mode" class="bg-medium hover:bg-medium/90 text-white font-bold py-2 px-4 rounded-md shadow-md transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-medium/50 flex-1 btn-hover active">
                        <i class="fa-solid fa-shield-half mr-2"></i>中等
                    </button>
                    <button id="hard-mode" class="bg-hard hover:bg-hard/90 text-white font-bold py-2 px-4 rounded-md shadow-md transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-hard/50 flex-1 btn-hover">
                        <i class="fa-solid fa-shield-exclamation mr-2"></i>困难
                    </button>
                </div>
            </div>
        </div>
        <div class="stats-container flex justify-between mb-4">
            <div class="bg-grid dark:bg-dark-grid text-center rounded-md p-3 flex-1 mr-2">
                <div class="text-xs uppercase text-white/70 dark:text-dark-muted">分数</div>
                <div id="score" class="text-xl font-bold text-white dark:text-dark-text">0</div>
            </div>
            <div class="bg-grid dark:bg-dark-grid text-center rounded-md p-3 flex-1">
                <div class="text-xs uppercase text-white/70 dark:text-dark-muted">最高分</div>
                <div id="best-score" class="text-xl font-bold text-white dark:text-dark-text">0</div>
            </div>
        </div>
        <div class="flex justify-between items-center mb-4">
            <div>
                <div class="text-secondary/80 dark:text-dark-muted mb-2" id="mode-description">
                    当前模式：标准模式 - 达到2048获胜
                </div>
                <div id="difficulty-description" class="text-secondary/80 dark:text-dark-muted">
                    当前难度：中等 - 4x4网格
                </div>
            </div>
            <button id="ai-analysis-button" class="bg-primary dark:bg-dark-primary hover:bg-primary/90 text-white w-12 h-12 rounded-full shadow-md transition-all duration-200 transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-primary/50 flex items-center justify-center">
                <i class="fa-solid fa-robot dark:text-[#282828]"></i>
            </button>
        </div>
        <div class="game-container grid-4x4" id="game-container">
            <div class="grid-container" id="grid-container"></div>
            <div class="tile-container" id="tile-container"></div>
        </div>
        <div id="game-touch-area" class="mt-4 h-5 bg-transparent"></div>
        <div id="game-message" class="fixed inset-0 flex items-center justify-center bg-black/50 z-50 hidden">
            <div class="bg-white rounded-lg p-6 max-w-md w-full text-center shadow-xl transform transition-all duration-300 scale-95 opacity-0">
                <h2 id="game-message-title" class="text-2xl font-bold text-secondary mb-4">恭喜你获胜！</h2>
                <p id="game-message-text" class="text-secondary/80 mb-6">你达到了2048分，可以继续游戏挑战更高分数，或者重新开始。</p>
                <button id="game-message-button" class="bg-primary hover:bg-primary/90 text-white font-bold py-3 px-6 rounded-md shadow-md transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary/50">
                    <i class="fa-solid fa-refresh mr-2"></i>再玩一次
                </button>
            </div>
        </div>
        <div id="pause-menu" class="fixed inset-0 flex items-center justify-center bg-black/50 z-50 hidden">
            <div class="bg-white rounded-lg p-6 max-w-md w-full text-center shadow-xl transform transition-all duration-300 scale-95 opacity-0">
                <h2 class="text-2xl font-bold text-secondary mb-4">游戏暂停</h2>
                <div class="flex flex-col gap-3">
                    <button id="resume-button" class="bg-primary hover:bg-primary/90 text-white font-bold py-3 px-6 rounded-md shadow-md transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary/50">
                        <i class="fa-solid fa-play mr-2"></i><span class="text-content">继续<span class="hide-small">游戏</span></span>
                    </button>
                    <button id="restart-button" class="bg-secondary hover:bg-secondary/90 text-white font-bold py-3 px-6 rounded-md shadow-md transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-secondary/50">
                        <i class="fa-solid fa-refresh mr-2"></i><span class="text-content">重<span class="hide-small">新</span>开<span class="hide-small">始</span></span>
                    </button>
                    <div class="flex justify-center gap-4 mt-2">
                        <button id="settings-button" class="text-primary hover:text-primary/80 focus:outline-none text-sm">
                            <i class="fa-solid fa-cog mr-1"></i><span class="text-content">设置</span>
                        </button>
                        <button id="help-button" class="text-primary hover:text-primary/80 focus:outline-none text-sm">
                            <i class="fa-solid fa-question mr-1"></i><span class="text-content">帮助</span>
                        </button>
                     </div>
                </div>
            </div>
        </div>
        <div id="settings-modal" class="fixed inset-0 flex items-center justify-center bg-black/50 z-50 hidden">
            <div class="bg-white rounded-lg p-6 max-w-md w-full text-center shadow-xl transform transition-all duration-300 scale-95 opacity-0">
                <h2 class="text-2xl font-bold text-secondary mb-4">设置</h2>
                <div class="flex flex-col gap-3">
                    <button id="data-transfer-button" class="bg-secondary hover:bg-secondary/90 text-white font-bold py-3 px-6 rounded-md shadow-md transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-secondary/50">
                        <i class="fa-solid fa-database mr-2"></i><span class="settings-text">数据管理</span>
                    </button>
                    <button id="reset-settings-button" class="bg-secondary hover:bg-secondary/90 text-white font-bold py-3 px-6 rounded-md shadow-md transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-secondary/50">
                        <i class="fa-solid fa-rotate-right mr-2"></i><span class="settings-text">重置所有设置</span>
                    </button>
                    <div class="flex items-center justify-between mt-2 mb-2 px-2">
                        <span class="text-gray-700 dark:text-dark-muted">GPU加速</span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="gpu-acceleration" class="sr-only peer" checked title="GPU加速">
                            <div class="w-11 h-6 bg-gray-300 dark:bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                        </label>
                    </div>
                    <div class="flex items-center justify-between mt-2 mb-2 px-2">
                        <label for="theme-toggle" class="text-gray-700 dark:text-dark-muted">外观</label>
                        <div class="custom-select relative w-full max-w-[180px]">
                            <div class="select-selected flex items-center justify-between px-3 py-2 bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-white rounded-md shadow border border-gray-300 dark:border-gray-600 cursor-pointer transition-all duration-200 hover:border-primary/50">
                                <span class="selected-value"><i class="fa-solid fa-circle-half-stroke mr-1"></i>跟随浏览器</span>
                                <i class="fa fa-chevron-down text-xs ml-2 text-gray-500 dark:text-gray-400"></i>
                            </div>
                            <div class="select-items absolute mt-1 w-full bg-gray-100 dark:bg-gray-800 rounded-md shadow-lg border border-gray-300 dark:border-gray-600 z-20 max-h-0 opacity-0 overflow-y-auto transition-all duration-300 ease-in-out">
                                <div class="select-item px-3 py-2 hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-800 dark:text-white cursor-pointer transition-colors" data-value="auto"><i class="fa-solid fa-circle-half-stroke mr-1"></i>跟随浏览器</div>
                                <div class="select-item px-3 py-2 hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-800 dark:text-white cursor-pointer transition-colors" data-value="light"><i class="fa-solid fa-sun mr-1"></i>浅色</div>
                                <div class="select-item px-3 py-2 hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-800 dark:text-white cursor-pointer transition-colors" data-value="dark"><i class="fa-solid fa-moon mr-1"></i>深色</div>
                            </div>
                        </div>
                        <select id="theme-toggle" style="display: none;" class="bg-grid text-gray-800 dark:text-white p-2 rounded-md shadow-md transition-all duration-200 focus:outline-none dark:bg-dark-grid" title="选择外观">
                            <option value="auto">&#xf042; 跟随浏览器</option>
                            <option value="light">&#xf185; 浅色</option>
                            <option value="dark">&#xf186; 深色</option>
                        </select>
                    </div>
                    <div class="text-sm text-secondary/70 mt-4">2048 v1.16 | by TheFurina</div>
                    <button id="close-settings-button" class="text-secondary/60 hover:text-secondary focus:outline-none absolute top-5 right-8 text-xl" title="关闭设置">
                        <i class="fa-solid fa-times"></i>
                    </button>
                    <a href="https://github.com/TheFurina/2048-game" class="text-primary hover:underline flex items-center gap-1 text-xs absolute bottom-4 right-4" target="_blank"><i class="fa-brands fa-github"></i> 项目主页</a>
                </div>
            </div>
        </div>
        <div id="help-modal" class="fixed inset-0 flex items-center justify-center bg-black/50 z-50 hidden modal-enter">
            <div class="bg-white rounded-lg p-6 max-w-md w-full max-h-[90vh] overflow-y-auto shadow-xl">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-secondary">游戏介绍</h2>
                    <button id="close-help" class="text-secondary/60 hover:text-secondary focus:outline-none" title="关闭帮助">
                        <i class="fa-solid fa-times text-xl"></i>
                    </button>
                </div>
                <div class="markdown-content">
                    <p>2048 是一款流行的数字拼图游戏，玩家通过滑动数字方块来合并相同的数字，最终创建出 2048 这个数字。</p>
                    <h2>游戏规则</h2>
                    <ul>
                        <li>使用键盘方向键或在触摸屏上滑动，即可移动方块</li>
                        <li>相同数字的方块在移动后相遇会合并成它们的和</li>
                        <li>每次移动后会随机生成一个新的 2 或 4</li>
                        <li>当无法进行任何移动时游戏结束</li>
                        <li>创建出 2048 方块即可获胜（标准模式）</li>
                    </ul>
                    <h2>游戏模式</h2>
                    <ul>
                        <li><strong>标准模式</strong>: 目标是创建出 2048 方块</li>
                        <li><strong>无尽模式</strong>: 没有目标分数，可以继续游戏挑战更高分数</li>
                    </ul>
                    <h2>难度设置</h2>
                    <ul>
                        <li><strong>简单</strong>: 更容易生成 4（约 40% 的概率）</li>
                        <li><strong>中等</strong>: 标准难度，生成 4 的概率为 10%</li>
                        <li><strong>困难</strong>: 更难生成 4（约 5% 的概率），但合并得分更高</li>
                    </ul>
                    <h2>操作提示</h2>
                    <ul>
                        <li>按 <kbd>P</kbd> 或 <kbd>ESC</kbd> 键暂停游戏</li>
                        <li>点击 <i class="fa-solid fa-undo"></i> 按钮或按 <code><kbd>Ctrl + Z</kbd></code> 撤销上一步操作（最多可撤销 10 步）</li>
                        <li>支持键盘和触摸屏操作</li>
                        <li>游戏进度会自动保存</li>
                        <li>支持导入/导出游戏数据</li>
                    </ul>
                    <h2>技巧与策略</h2>
                    <ul>
                        <li>尽量保持一个角落作为高数字的存放点</li>
                        <li>尝试创建一个递增的数字序列</li>
                        <li>避免在中间位置合并数字</li>
                        <li>优先使用两个方向进行移动（例如上下或左右）</li>
                    </ul>
                    <p>祝你游戏愉快！ 🎮</p>
                    <i><strong>P.S.</strong> 在2048游戏中，理论最高值分别为：3×3棋盘 <strong>4096</strong>，4×4棋盘 <strong>131072</strong>，5×5棋盘 <strong>2097152</strong>。合理规划合并路径，优先向角落累积大数，可提高达成高分的概率！</i>
                </div>
            </div>
        </div>
        <div id="data-transfer-modal" class="fixed inset-0 flex items-center justify-center bg-black/50 z-50 hidden">
            <div class="bg-white rounded-lg p-6 max-w-md w-full text-center shadow-xl transform transition-all duration-300 scale-95 opacity-0">
                <h2 class="text-2xl font-bold text-secondary mb-4">数据管理</h2>
                <div class="flex flex-col gap-3 mb-4">
                    <button id="export-data-button" class="bg-primary hover:bg-primary/90 text-white font-bold py-3 px-6 rounded-md shadow-md transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary/50">
                        <i class="fa-solid fa-upload mr-2"></i>导出数据
                    </button>
                    <button id="import-data-button" class="bg-secondary hover:bg-secondary/90 text-white font-bold py-3 px-6 rounded-md shadow-md transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-secondary/50">
                        <i class="fa-solid fa-download mr-2"></i>导入数据
                    </button>
                    <button id="clear-data-exit-button" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-md shadow-md transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-500/50" onclick="if(confirm('确定要清除所有数据并退出吗？')) { localStorage.clear(); window.close(); }">
                        <i class="fa-solid fa-trash-alt mr-2"></i>清除数据并退出
                    </button>
                </div>
                <textarea id="data-textarea" class="w-full p-3 border border-gray-300 rounded-md mb-4 h-32 text-sm dark:bg-dark-surface dark:border-dark-muted dark:text-dark-text" placeholder="在此复制导出的数据或输入要导入的数据..."></textarea>
                <button id="close-data-modal" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-md shadow-md transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray/50">
                    <i class="fa-solid fa-times mr-2"></i>关闭
                </button>
            </div>
        </div>
        <footer class="mt-6 py-3 text-center text-secondary/50 dark:text-dark-muted/50 text-base">
            <p><i class="fa-solid fa-cube mr-2"></i>滑动之间 数字新生</p>
        </footer>
    </div>
    <script>
        const config = { // 游戏配置
            initialTiles: 2, // 初始生成的方块数量
            winningValue: 2048, // 获胜目标值
            touchThreshold: 10, // 触摸滑动的最小距离
            maxUndoSteps: 10, // 最大撤销步数
            difficultySettings: { // 难度设置
                easy: { // 简单
                    fourProbability: 0.4, // 4出现的概率为40%
                    scoreMultiplier: 1 // 得分乘数
                },
                medium: { // 中等
                    fourProbability: 0.1, // 4出现的概率为10%
                    scoreMultiplier: 1 // 得分乘数
                },
                hard: { // 困难
                    fourProbability: 0.05, // 4出现的概率为5%
                    scoreMultiplier: 1.5 // 得分乘数
                }
            }
        };
        const gameState = {
            gpuAccelerationEnabled: localStorage.getItem('2048-gpu-acceleration') !== 'false',
            grid: [],
            gridSize: 4,
            score: 0,
            bestScore: 0,
            gameOver: false,
            gameWon: false,
            isEndlessMode: false,
            isPaused: false,
            difficulty: 'medium',
            history: [],
            touchStartX: 0,
            touchStartY: 0,
            touchEndX: 0,
            touchEndY: 0
        };
        function showModal(modalId) { const modal = document.getElementById(modalId); if (modal) { modal.classList.remove('hidden'); setTimeout(() => { modal.querySelector('div').classList.remove('scale-95', 'opacity-0'); modal.querySelector('div').classList.add('scale-100', 'opacity-100'); }, 10); } }
        function hideModal(modalId) { const modal = document.getElementById(modalId); if (modal) { modal.querySelector('div').classList.remove('scale-100', 'opacity-100'); modal.querySelector('div').classList.add('scale-95', 'opacity-0'); setTimeout(() => { modal.classList.add('hidden'); }, 300); } }
        function exportGameData() { const data = { grid: gameState.grid, score: gameState.score, bestScore: gameState.bestScore, gridSize: gameState.gridSize, difficulty: gameState.difficulty, isEndlessMode: gameState.isEndlessMode, timestamp: new Date().toISOString() }; const dataStr = btoa(JSON.stringify(data)); document.getElementById('data-textarea').value = dataStr; }
        function checkGameState() { if (gameState.gameOver) { console.log('游戏已结束'); } if (gameState.gameWon) { console.log('游戏已获胜'); } } function importGameData(dataStr) { try { if (!dataStr) throw new Error('数据不能为空'); let decodedData; try { decodedData = atob(dataStr); } catch (e) { throw new Error('无效的Base64格式'); } let data; try { data = JSON.parse(decodedData); } catch (e) { throw new Error('JSON解析失败：' + e.message); } if (!data || typeof data !== 'object') throw new Error('数据必须是有效的JSON对象'); const requiredFields = ['grid', 'score', 'bestScore', 'gridSize', 'difficulty', 'isEndlessMode']; const missingFields = requiredFields.filter(field => !(field in data)); if (missingFields.length > 0) throw new Error('缺少必要字段：' + missingFields.join(', ')); if (!Array.isArray(data.grid) || data.grid.length === 0) throw new Error('无效的游戏网格数据');
        console.log('导入数据的 grid 长度:', data.grid.length, 'gridSize:', data.gridSize);
        if (data.grid.length !== data.gridSize || data.grid.some(row => row.length !== data.gridSize)) { console.log('网格大小检查失败，grid 长度:', data.grid.length, 'grid 行长度:', data.grid.map(row => row.length), 'gridSize:', data.gridSize);
            throw new Error('导入的滑块数字指示的网格大小与导入数据指示的网格大小不一致');
        }
        console.log('开始检查滑块数字是否为2的次幂');
        const invalidTiles = data.grid.flatMap(row => row.filter(tile => tile && (tile.value <= 0 || (tile.value & (tile.value - 1)) !== 0)));
        console.log('无效的滑块数字:', invalidTiles.map(tile => tile.value));
        if (invalidTiles.length > 0) {
            console.log('检测到无效的滑块数字');
            throw new Error('导入的滑块数字必须是2的次幂');
        }
        gameState.grid = data.grid; gameState.score = data.score; gameState.bestScore = data.bestScore; gameState.gridSize = data.gridSize; gameState.difficulty = data.difficulty; gameState.isEndlessMode = data.isEndlessMode; document.querySelector('.game-container').classList.remove('grid-3x3', 'grid-4x4', 'grid-5x5'); document.querySelector('.game-container').classList.add(`grid-${data.gridSize}x${data.gridSize}`); initGridContainer(); updateDocumentTitle(); renderAllTiles(); elements.scoreDisplay.textContent = gameState.score; elements.bestScoreDisplay.textContent = gameState.bestScore; elements.modeDescription.textContent = gameState.isEndlessMode ? "当前模式：无尽模式 - 尽可能获得高分" : "当前模式：标准模式 - 达到2048获胜"; elements.difficultyDescription.textContent = `当前难度：${getDifficultyName()} - ${gameState.gridSize}×${gameState.gridSize}网格`; checkGameState(); saveGameState(); gameState.history = []; updateUndoButtonState(); alert('数据导入成功！'); } catch (e) { alert('导入失败：' + e.message); } }
        const elements = {
            gridContainer: document.getElementById('grid-container'),
            tileContainer: document.getElementById('tile-container'),
            scoreDisplay: document.getElementById('score'),
            bestScoreDisplay: document.getElementById('best-score'),
            newGameButton: document.getElementById('new-game'),
            endlessModeButton: document.getElementById('endless-mode'),
            retryGameButton: document.getElementById('retry-game'),
            pauseButton: document.getElementById('pause-button'),
            resumeButton: document.getElementById('resume-button'),
            restartButton: document.getElementById('restart-button'),
            undoButton: document.getElementById('undo-button'),
            themeToggle: document.getElementById('theme-toggle'),
            gameMessage: document.getElementById('game-message'),
            gameMessageTitle: document.getElementById('game-message-title'),
            gameMessageText: document.getElementById('game-message-text'),
            gameMessageButton: document.getElementById('game-message-button'),
            pauseMenu: document.getElementById('pause-menu'),
            settingsModal: document.getElementById('settings-modal'),
            settingsButton: document.getElementById('settings-button'),
            closeSettingsButton: document.getElementById('close-settings-button'),
            easyModeButton: document.getElementById('easy-mode'),
            mediumModeButton: document.getElementById('medium-mode'),
            hardModeButton: document.getElementById('hard-mode'),
            grid3x3Button: document.getElementById('grid-3x3'),
            grid4x4Button: document.getElementById('grid-4x4'),
            grid5x5Button: document.getElementById('grid-5x5'),
            modeDescription: document.getElementById('mode-description'),
            difficultyDescription: document.getElementById('difficulty-description'),
            helpButton: document.getElementById('help-button'),
            helpModal: document.getElementById('help-modal'),
            closeHelp: document.getElementById('close-help'),
            resetSettingsButton: document.getElementById('reset-settings-button'),
            gameHeader: document.getElementById('game-header'),
            gameTitle: document.getElementById('game-title'),
            statsContainer: document.getElementById('stats-container'),
            gameButtons: document.getElementById('game-buttons'),
            difficultyButtons: document.getElementById('difficulty-buttons'),
            gameDescription: document.querySelector('.text-secondary\\/80.dark\\:text-dark-muted.mb-2'),
            gameTouchArea: document.getElementById('game-touch-area'),
            gameContainer: document.querySelector('.game-container')
        };
        function updateDocumentTitle() {
            const mode = gameState.isEndlessMode ? '无尽模式' : '标准模式';
            const difficulty = getDifficultyName();
            document.title = `2048 | ${mode} | ${difficulty} | ${gameState.gridSize}×${gameState.gridSize} | 分数: ${gameState.score}`;
        }
        function createEmptyGrid() {
            const grid = [];
            for (let y = 0; y < gameState.gridSize; y++) {
                grid[y] = [];
                for (let x = 0; x < gameState.gridSize; x++) {
                    grid[y][x] = null;
                }
            }
            return grid;
        }
        function initGridContainer() {
            elements.gridContainer.innerHTML = '';
            for (let y = 0; y < gameState.gridSize; y++) {
                const gridRow = document.createElement('div');
                gridRow.className = 'grid-row';
                for (let x = 0; x < gameState.gridSize; x++) {
                    const gridCell = document.createElement('div');
                    gridCell.className = 'grid-cell';
                    gridRow.appendChild(gridCell);
                }
                elements.gridContainer.appendChild(gridRow);
            }
        }
        function generateRandomTile() {
            const availableCells = [];
            for (let y = 0; y < gameState.gridSize; y++) {
                for (let x = 0; x < gameState.gridSize; x++) {
                    if (gameState.grid[y][x] === null) {
                        availableCells.push({ x, y });
                    }
                }
            }
            if (availableCells.length > 0) {
                const cell = availableCells[Math.floor(Math.random() * availableCells.length)];
                const difficulty = config.difficultySettings[gameState.difficulty] || { fourProbability: 0.1 };
                const value = Math.random() < difficulty.fourProbability ? 4 : 2;
                gameState.grid[cell.y][cell.x] = {
                    value,
                    merged: false,
                    new: true
                };
                renderTile(cell.x, cell.y);
                return true;
            }
            return false;
        }
        function renderTile(x, y) {
            const tile = gameState.grid[y][x];
            if (!tile) return;
            const tileElement = document.createElement('div');
            tileElement.className = `tile tile-${tile.value} ${tile.new ? 'tile-appear' : ''} ${tile.value > 32768 ? 'tile-super' : ''} ${tile.value >= 10000 ? 'tile-5digit' : ''} ${gameState.gpuAccelerationEnabled ? 'gpu-accelerated' : ''}`;
            tileElement.textContent = tile.value;
            tileElement.dataset.pos = `${x}-${y}`;
            elements.tileContainer.appendChild(tileElement);
            if (tile.new) {
                setTimeout(() => {
                    tile.new = false;
                }, 200);
            }
        }
        function renderAllTiles() {
            elements.tileContainer.innerHTML = '';
            for (let y = 0; y < gameState.gridSize; y++) {
                for (let x = 0; x < gameState.gridSize; x++) {
                    if (gameState.grid[y][x]) {
                        renderTile(x, y);
                    }
                }
            }
        }
        function move(direction) {
            const modal = document.getElementById('ai-analysis-modal');
            if (gameState.isPaused || gameState.gameOver || !elements.gameMessage.classList.contains('hidden') || !modal.classList.contains('hidden')) return false;
            saveHistory();
            let moved = false;
            for (let y = 0; y < gameState.gridSize; y++) {
                for (let x = 0; x < gameState.gridSize; x++) {
                    if (gameState.grid[y][x]) {
                        gameState.grid[y][x].merged = false;
                    }
                }
            }
            switch(direction) {
                case 'up':
                    for (let x = 0; x < gameState.gridSize; x++) {
                        for (let y = 1; y < gameState.gridSize; y++) {
                            if (gameState.grid[y][x]) {
                                let newY = y;
                                while (newY > 0 && gameState.grid[newY - 1][x] === null) {
                                    newY--;
                                }
                                if (newY > 0 && gameState.grid[newY - 1][x] && 
                                    gameState.grid[newY - 1][x].value === gameState.grid[y][x].value &&
                                    !gameState.grid[newY - 1][x].merged) {
                                    gameState.grid[newY - 1][x].value *= 2;
                                    gameState.grid[newY - 1][x].merged = true;
                                    const mergedTile = gameState.grid[newY - 1][x];
                                    mergedTile.mergedAnimation = true;
                                    gameState.grid[y][x] = null;
                                    const difficulty = config.difficultySettings[gameState.difficulty] || { scoreMultiplier: 1 };
                                    gameState.score += gameState.grid[newY - 1][x].value * difficulty.scoreMultiplier;
                                    if (gameState.score > gameState.bestScore) {
                                        gameState.bestScore = gameState.score;
                                        elements.bestScoreDisplay.textContent = gameState.bestScore;
                                    }
                                    elements.scoreDisplay.textContent = gameState.score;
                                    updateDocumentTitle();
                                    moved = true;
                                } else if (newY !== y) {
                                    gameState.grid[newY][x] = gameState.grid[y][x];
                                    gameState.grid[y][x] = null;
                                    moved = true;
                                }
                            }
                        }
                    }
                    break;
                case 'down':
                    for (let x = 0; x < gameState.gridSize; x++) {
                        for (let y = gameState.gridSize - 2; y >= 0; y--) {
                            if (gameState.grid[y][x]) {
                                let newY = y;
                                while (newY < gameState.gridSize - 1 && gameState.grid[newY + 1][x] === null) {
                                    newY++;
                                }
                                if (newY < gameState.gridSize - 1 && gameState.grid[newY + 1][x] && 
                                    gameState.grid[newY + 1][x].value === gameState.grid[y][x].value &&
                                    !gameState.grid[newY + 1][x].merged) {
                                    gameState.grid[newY + 1][x].value *= 2;
                                    gameState.grid[newY + 1][x].merged = true;
                                    const mergedTile = gameState.grid[newY + 1][x];
                                    mergedTile.mergedAnimation = true;
                                    gameState.grid[y][x] = null;
                                    const difficulty = config.difficultySettings[gameState.difficulty] || { scoreMultiplier: 1 };
                                    gameState.score += gameState.grid[newY + 1][x].value * difficulty.scoreMultiplier;
                                    if (gameState.score > gameState.bestScore) {
                                        gameState.bestScore = gameState.score;
                                        elements.bestScoreDisplay.textContent = gameState.bestScore;
                                    }
                                    elements.scoreDisplay.textContent = gameState.score;
                                    updateDocumentTitle();
                                    moved = true;
                                } else if (newY !== y) {
                                    gameState.grid[newY][x] = gameState.grid[y][x];
                                    gameState.grid[y][x] = null;
                                    moved = true;
                                }
                            }
                        }
                    }
                    break;
                case 'left':
                    for (let y = 0; y < gameState.gridSize; y++) {
                        for (let x = 1; x < gameState.gridSize; x++) {
                            if (gameState.grid[y][x]) {
                                let newX = x;
                                while (newX > 0 && gameState.grid[y][newX - 1] === null) {
                                    newX--;
                                }
                                if (newX > 0 && gameState.grid[y][newX - 1] && 
                                    gameState.grid[y][newX - 1].value === gameState.grid[y][x].value &&
                                    !gameState.grid[y][newX - 1].merged) {
                                    gameState.grid[y][newX - 1].value *= 2;
                                    gameState.grid[y][newX - 1].merged = true;
                                    const mergedTile = gameState.grid[y][newX - 1];
                                    mergedTile.mergedAnimation = true;
                                    gameState.grid[y][x] = null;
                                    const difficulty = config.difficultySettings[gameState.difficulty] || { scoreMultiplier: 1 };
                                    gameState.score += gameState.grid[y][newX - 1].value * difficulty.scoreMultiplier;
                                    if (gameState.score > gameState.bestScore) {
                                        gameState.bestScore = gameState.score;
                                        elements.bestScoreDisplay.textContent = gameState.bestScore;
                                    }
                                    elements.scoreDisplay.textContent = gameState.score;
                                    updateDocumentTitle();
                                    moved = true;
                                } else if (newX !== x) {
                                    gameState.grid[y][newX] = gameState.grid[y][x];
                                    gameState.grid[y][x] = null;
                                    moved = true;
                                }
                            }
                        }
                    }
                    break;
                case 'right':
                    for (let y = 0; y < gameState.gridSize; y++) {
                        for (let x = gameState.gridSize - 2; x >= 0; x--) {
                            if (gameState.grid[y][x]) {
                                let newX = x;
                                while (newX < gameState.gridSize - 1 && gameState.grid[y][newX + 1] === null) {
                                    newX++;
                                }
                                if (newX < gameState.gridSize - 1 && gameState.grid[y][newX + 1] && 
                                    gameState.grid[y][newX + 1].value === gameState.grid[y][x].value &&
                                    !gameState.grid[y][newX + 1].merged) {
                                    gameState.grid[y][newX + 1].value *= 2;
                                    gameState.grid[y][newX + 1].merged = true;
                                    const mergedTile = gameState.grid[y][newX + 1];
                                    mergedTile.mergedAnimation = true;
                                    gameState.grid[y][x] = null;
                                    const difficulty = config.difficultySettings[gameState.difficulty] || { scoreMultiplier: 1 };
                                    gameState.score += gameState.grid[y][newX + 1].value * difficulty.scoreMultiplier;
                                    if (gameState.score > gameState.bestScore) {
                                        gameState.bestScore = gameState.score;
                                        elements.bestScoreDisplay.textContent = gameState.bestScore;
                                    }
                                    elements.scoreDisplay.textContent = gameState.score;
                                    updateDocumentTitle();
                                    moved = true;
                                } else if (newX !== x) {
                                    gameState.grid[y][newX] = gameState.grid[y][x];
                                    gameState.grid[y][x] = null;
                                    moved = true;
                                }
                            }
                        }
                    }
                    break;
            }
            if (moved) {
                elements.tileContainer.innerHTML = '';
                renderAllTiles();
                setTimeout(() => {
                    for (let y = 0; y < gameState.gridSize; y++) {
                        for (let x = 0; x < gameState.gridSize; x++) {
                            if (gameState.grid[y][x] && gameState.grid[y][x].mergedAnimation) {
                                const tileElement = elements.tileContainer.querySelector(`.tile[data-pos="${x}-${y}"]`);
                                if (tileElement) {
                                    tileElement.classList.add('tile-merge');
                                    setTimeout(() => {
                                        if (gameState.grid[y][x]) {
                                            gameState.grid[y][x].mergedAnimation = false;
                                        }
                                    }, 200);
                                }
                            }
                        }
                    }
                }, 10);
                setTimeout(() => {
                    generateRandomTile();
                    if (!gameState.gameWon) {
                        checkWin();
                    }
                    checkGameOver();
                    saveGameState();
                }, 200);
            }
            updateUndoButtonState();
            return moved;
        }
        function checkWin() {
            for (let y = 0; y < gameState.gridSize; y++) {
                for (let x = 0; x < gameState.gridSize; x++) {
                    if (gameState.grid[y][x] && gameState.grid[y][x].value >= config.winningValue) {
                        gameState.gameWon = true;
                        if (!gameState.isEndlessMode) {
                            showGameMessage("恭喜你获胜！", "你达到了2048分，可以继续游戏挑战更高分数，或者重新开始。");
                        }
                        return true;
                    }
                }
            }
            return false;
        }
        function checkGameOver() {
            for (let y = 0; y < gameState.gridSize; y++) {
                for (let x = 0; x < gameState.gridSize; x++) {
                    if (gameState.grid[y][x] === null) {
                        return false;
                    }
                }
            }
            for (let y = 0; y < gameState.gridSize; y++) {
                for (let x = 0; x < gameState.gridSize; x++) {
                    const value = gameState.grid[y][x].value;
                    if (x < gameState.gridSize - 1 && gameState.grid[y][x + 1] && gameState.grid[y][x + 1].value === value) {
                        return false;
                    }
                    if (y < gameState.gridSize - 1 && gameState.grid[y + 1][x] && gameState.grid[y + 1][x].value === value) {
                        return false;
                    }
                }
            }
            gameState.gameOver = true;
            showGameMessage("游戏结束！", "无法进行任何移动。");
            return true;
        }
        function showGameMessage(title, text) {
            elements.gameMessageTitle.textContent = title;
            elements.gameMessageText.textContent = text;
            elements.gameMessage.classList.remove('hidden');
            setTimeout(() => {
                const messageBox = elements.gameMessage.querySelector('.bg-white');
                messageBox.classList.add('scale-100');
                messageBox.classList.remove('scale-95', 'opacity-0');
            }, 10);
        }
        function hideGameMessage() {
            const messageBox = elements.gameMessage.querySelector('.bg-white');
            messageBox.classList.remove('scale-100');
            messageBox.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                elements.gameMessage.classList.add('hidden');
            }, 200);
        }
        function togglePause() {
            gameState.isPaused = !gameState.isPaused;
            if (gameState.isPaused) {
                elements.pauseMenu.classList.remove('hidden');
                setTimeout(() => {
                    const pauseBox = elements.pauseMenu.querySelector('.bg-white');
                    pauseBox.classList.add('scale-100');
                    pauseBox.classList.remove('scale-95', 'opacity-0');
                }, 10);
            } else {
                const pauseBox = elements.pauseMenu.querySelector('.bg-white');
                pauseBox.classList.remove('scale-100');
                pauseBox.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    elements.pauseMenu.classList.add('hidden');
                }, 200);
            }
        }
        function saveHistory() {
            const gridCopy = JSON.parse(JSON.stringify(gameState.grid));
            gameState.history.push({
                grid: gridCopy,
                score: gameState.score
            });
            if (gameState.history.length > config.maxUndoSteps) {
                gameState.history.shift();
            }
            updateUndoButtonState();
        }
        function undoMove() {
            if (gameState.history.length === 0) return;
            const lastState = gameState.history.pop();
            gameState.grid = lastState.grid;
            gameState.score = lastState.score;
            elements.scoreDisplay.textContent = gameState.score;
            renderAllTiles();
            gameState.gameOver = false;
            gameState.gameWon = false;
            hideGameMessage();
            updateDocumentTitle();
            saveGameState();
            updateUndoButtonState();
        }
        function updateUndoButtonState() {
            if (gameState.history.length === 0) {
                elements.undoButton.disabled = true;
                elements.undoButton.classList.add('opacity-50', 'cursor-not-allowed');
                elements.undoButton.title = '无法撤销（没有历史记录）';
            } else {
                elements.undoButton.disabled = false;
                elements.undoButton.classList.remove('opacity-50', 'cursor-not-allowed');
                elements.undoButton.title = `撤销上一步（可撤销 ${gameState.history.length} 步）`;
            }
        }
        function updateDifficultyButtons() {
            elements.easyModeButton.classList.remove('ring-2', 'ring-easy/50');
            elements.mediumModeButton.classList.remove('ring-2', 'ring-medium/50');
            elements.hardModeButton.classList.remove('ring-2', 'ring-hard/50');
            switch(gameState.difficulty) {
                case 'easy':
                    elements.easyModeButton.classList.add('ring-2', 'ring-easy/50');
                    break;
                case 'medium':
                    elements.mediumModeButton.classList.add('ring-2', 'ring-medium/50');
                    break;
                case 'hard':
                    elements.hardModeButton.classList.add('ring-2', 'ring-hard/50');
                    break;
            }
        }
        function updateGridButtonState(gridSize) {
            elements.grid3x3Button.classList.remove('ring-2', 'ring-green-300');
            elements.grid4x4Button.classList.remove('ring-2', 'ring-blue-300');
            elements.grid5x5Button.classList.remove('ring-2', 'ring-purple-300');
            switch(gridSize) {
                case 3:
                    elements.grid3x3Button.classList.add('ring-2', 'ring-green-300');
                    break;
                case 4:
                    elements.grid4x4Button.classList.add('ring-2', 'ring-blue-300');
                    break;
                case 5:
                    elements.grid5x5Button.classList.add('ring-2', 'ring-purple-300');
                    break;
            }
        }
        function getDifficultyName() {
            switch(gameState.difficulty) {
                case 'easy': return '简单';
                case 'medium': return '中等';
                case 'hard': return '困难';
                default: return '中等';
            }
        }
        elements.dataTransferButton = document.getElementById('data-transfer-button');
        elements.dataTransferModal = document.getElementById('data-transfer-modal');
        elements.exportDataButton = document.getElementById('export-data-button');
        elements.importDataButton = document.getElementById('import-data-button');
        elements.dataTextarea = document.getElementById('data-textarea');
        elements.closeDataModal = document.getElementById('close-data-modal');
        function setupDataTransfer() { function handleImportClick() { const data = elements.dataTextarea.value.trim(); if (data && confirm('确定要导入数据吗？这将覆盖当前游戏状态。')) importGameData(data); } elements.dataTransferButton.addEventListener('click', () => { const modal = document.getElementById('data-transfer-modal'); modal.classList.remove('hidden'); modal.classList.add('modal-enter'); setTimeout(() => { modal.classList.add('modal-enter-active'); }, 10); }); elements.exportDataButton.addEventListener('click', () => { exportGameData(); }); elements.importDataButton.removeEventListener('click', handleImportClick); elements.importDataButton.addEventListener('click', handleImportClick); elements.closeDataModal.addEventListener('click', () => {
            const modal = document.getElementById('data-transfer-modal');
            modal.classList.add('modal-exit-active');
            setTimeout(() => {
                modal.classList.add('hidden');
                modal.classList.remove('modal-exit-active', 'modal-enter', 'modal-enter-active');
            }, 300);
        }) } window.addEventListener('load', setupDataTransfer);
        function saveGameState() {
            localStorage.setItem('2048-game-state', JSON.stringify({
                grid: gameState.grid,
                gridSize: gameState.gridSize,
                score: gameState.score,
                bestScore: gameState.bestScore,
                gameOver: gameState.gameOver,
                gameWon: gameState.gameWon,
                isEndlessMode: gameState.isEndlessMode,
                difficulty: gameState.difficulty,
                history: gameState.history
            }));
        }
        function initGame(isEndlessMode = false, gridSize = gameState.gridSize) {
            const previousBestScore = gameState.bestScore;
            gameState.grid = createEmptyGrid();
            gameState.gridSize = gridSize;
            gameState.score = 0;
            gameState.gameOver = false;
            gameState.gameWon = false;
            gameState.isEndlessMode = isEndlessMode;
            gameState.history = [];
            elements.scoreDisplay.textContent = gameState.score;
            elements.bestScoreDisplay.textContent = previousBestScore;
            document.querySelector('.game-container').classList.remove('grid-3x3', 'grid-4x4', 'grid-5x5');
            document.querySelector('.game-container').classList.add(`grid-${gridSize}x${gridSize}`);
            initGridContainer();
            elements.tileContainer.innerHTML = '';
            for (let i = 0; i < config.initialTiles; i++) {
                generateRandomTile();
            }
            updateDifficultyButtons();
            updateGridButtonState(gridSize);
            elements.modeDescription.textContent = isEndlessMode 
                ? "当前模式：无尽模式 - 尽可能获得高分" 
                : "当前模式：标准模式 - 达到2048获胜";
            elements.difficultyDescription.textContent = `当前难度：${getDifficultyName()} - ${gameState.gridSize}×${gameState.gridSize}网格`;
            hideGameMessage();
            updateDocumentTitle();
            updateUndoButtonState();
            saveGameState();
        }
        function toggleTheme() {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('2048-theme', isDark ? 'dark' : 'light');
            elements.themeToggle.querySelector('i').className = isDark ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
        }
        function resetAllSettings() {
            if (confirm('确定要重置所有设置吗？这将清除游戏进度和偏好设置。')) {
                localStorage.removeItem('2048-game-state');
                localStorage.removeItem('2048-theme');
                localStorage.removeItem('2048-gpu-acceleration');
                document.documentElement.classList.remove('dark');
                location.reload();
            }
        }
        function handleResize() {
            const isCompact = window.innerWidth < 400;
            if (isCompact) {
                elements.gameHeader && elements.gameHeader.classList.add('compact-header');
                elements.gameTitle && elements.gameTitle.classList.add('compact-title');
                elements.statsContainer && elements.statsContainer.classList.add('compact-stats');
                elements.gameButtons && elements.gameButtons.classList.add('compact-buttons');
                elements.difficultyButtons && elements.difficultyButtons.classList.add('compact-difficulty');
                elements.gameDescription && elements.gameDescription.classList.add('compact-description');
                elements.gameMessage && elements.gameMessage.classList.add('compact-message');
            } else {
                elements.gameHeader && elements.gameHeader.classList.remove('compact-header');
                elements.gameTitle && elements.gameTitle.classList.remove('compact-title');
                elements.statsContainer && elements.statsContainer.classList.remove('compact-stats');
                elements.gameButtons && elements.gameButtons.classList.remove('compact-buttons');
                elements.difficultyButtons && elements.difficultyButtons.classList.remove('compact-difficulty');
                elements.gameDescription && elements.gameDescription.classList.remove('compact-description');
                elements.gameMessage && elements.gameMessage.classList.remove('compact-message');
            }
        }
        function initEventListeners() {
            document.addEventListener('keydown', (e) => {
                if (gameState.isPaused || gameState.gameOver || (gameState.gameWon && !gameState.isEndlessMode) || !elements.helpModal.classList.contains('hidden')) return;
                if ([37, 38, 39, 40, 80, 27].includes(e.keyCode)) {
                    e.preventDefault();
                }
                switch(e.keyCode) {
                    case 38:
                        move('up');
                        break;
                    case 40:
                        move('down');
                        break;
                    case 37:
                        move('left');
                        break;
                    case 39:
                        move('right');
                        break;
                    case 80:
                    case 27:
                        togglePause();
                        break;
                    case 90:
                        if (e.ctrlKey || e.metaKey) {
                            undoMove();
                        }
                        break;
                }
            }, { passive: false });
            elements.gameContainer.addEventListener('touchstart', (e) => {
                if (gameState.isPaused || gameState.gameOver || (gameState.gameWon && !gameState.isEndlessMode) || !elements.helpModal.classList.contains('hidden')) return;
                gameState.touchStartX = e.touches[0].clientX;
                gameState.touchStartY = e.touches[0].clientY;
            }, { passive: false });
            elements.gameContainer.addEventListener('touchmove', (e) => {
                e.preventDefault();
            }, { passive: false });
            elements.gameContainer.addEventListener('touchend', (e) => {
                if (gameState.isPaused || gameState.gameOver || (gameState.gameWon && !gameState.isEndlessMode) || !elements.helpModal.classList.contains('hidden')) return;
                gameState.touchEndX = e.changedTouches[0].clientX;
                gameState.touchEndY = e.changedTouches[0].clientY;
                const dx = gameState.touchEndX - gameState.touchStartX;
                const dy = gameState.touchEndY - gameState.touchStartY;
                if (Math.abs(dx) > Math.abs(dy)) {
                    if (Math.abs(dx) > config.touchThreshold) {
                        move(dx > 0 ? 'right' : 'left');
                    }
                } else {
                    if (Math.abs(dy) > config.touchThreshold) {
                        move(dy > 0 ? 'down' : 'up');
                    }
                }
            }, { passive: true });
            elements.newGameButton.addEventListener('click', () => {
                initGame(false, gameState.gridSize);
            });
            elements.endlessModeButton.addEventListener('click', () => {
                initGame(true, gameState.gridSize);
            });
            elements.gameMessageButton.addEventListener('click', () => {
                hideGameMessage();
                initGame(gameState.isEndlessMode, gameState.gridSize);
            });
            elements.pauseButton.addEventListener('click', togglePause);
            elements.resumeButton.addEventListener('click', togglePause);
            elements.restartButton.addEventListener('click', () => {
                gameState.isPaused = false;
                elements.pauseMenu.classList.add('hidden');
                initGame(gameState.isEndlessMode, gameState.gridSize);
            });
            elements.undoButton.addEventListener('click', undoMove);
            let themeMediaQuery;
            const updateTheme = (e) => {
                const isDark = e ? e.matches : window.matchMedia('(prefers-color-scheme: dark)').matches;
                document.documentElement.classList.toggle('dark', isDark);
            };
            elements.themeToggle.addEventListener('change', function() {
                if (window.themeMediaQueryListener) {
                    window.themeMediaQueryListener.mediaQuery.removeEventListener('change', window.themeMediaQueryListener.handler);
                    window.themeMediaQueryListener = null;
                }
                const theme = this.value;
                if (theme === 'auto') {
                    const themeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                    const updateTheme = (e) => {
                        const isDark = e ? e.matches : window.matchMedia('(prefers-color-scheme: dark)').matches;
                        document.documentElement.classList.toggle('dark', isDark);
                    };
                    themeMediaQuery.addEventListener('change', updateTheme);
                    updateTheme(themeMediaQuery);
                    window.themeMediaQueryListener = {
                        mediaQuery: themeMediaQuery,
                        handler: updateTheme
                    };
                    localStorage.setItem('2048-theme', 'auto');
                } else {
                    const isDark = theme === 'dark';
                    document.documentElement.classList.toggle('dark', isDark);
                    localStorage.setItem('2048-theme', theme);
                }
            });
            elements.easyModeButton.addEventListener('click', () => {
                gameState.difficulty = 'easy';
                updateDifficultyButtons();
                elements.difficultyDescription.textContent = `当前难度：${getDifficultyName()} - ${gameState.gridSize}×${gameState.gridSize}网格`;
                saveGameState();
            });
            elements.mediumModeButton.addEventListener('click', () => {
                gameState.difficulty = 'medium';
                updateDifficultyButtons();
                elements.difficultyDescription.textContent = `当前难度：${getDifficultyName()} - ${gameState.gridSize}×${gameState.gridSize}网格`;
                saveGameState();
            });
            elements.hardModeButton.addEventListener('click', () => {
                gameState.difficulty = 'hard';
                updateDifficultyButtons();
                elements.difficultyDescription.textContent = `当前难度：${getDifficultyName()} - ${gameState.gridSize}×${gameState.gridSize}网格`;
                saveGameState();
            });
            elements.grid3x3Button.addEventListener('click', () => {
                gameState.gridSize = 3;
                updateGridButtonState(3);
                elements.difficultyDescription.textContent = `当前难度：${getDifficultyName()} - ${gameState.gridSize}×${gameState.gridSize}网格`;
                initGame(gameState.isEndlessMode, 3);
            });
            elements.grid4x4Button.addEventListener('click', () => {
                gameState.gridSize = 4;
                updateGridButtonState(4);
                elements.difficultyDescription.textContent = `当前难度：${getDifficultyName()} - ${gameState.gridSize}×${gameState.gridSize}网格`;
                initGame(gameState.isEndlessMode, 4);
            });
            elements.grid5x5Button.addEventListener('click', () => {
                gameState.gridSize = 5;
                updateGridButtonState(5);
                elements.difficultyDescription.textContent = `当前难度：${getDifficultyName()} - ${gameState.gridSize}×${gameState.gridSize}网格`;
                initGame(gameState.isEndlessMode, 5);
            });
            elements.dataTransferButton.addEventListener('click', () => { showModal('data-transfer-modal'); });
            elements.settingsButton.addEventListener('click', () => {
                showModal('settings-modal');
            });
            elements.closeSettingsButton.addEventListener('click', () => {
                hideModal('settings-modal');
            });
            elements.gpuAccelerationToggle = document.getElementById('gpu-acceleration');
            elements.gpuAccelerationToggle.checked = gameState.gpuAccelerationEnabled;
            elements.gpuAccelerationToggle.addEventListener('change', (e) => {
                gameState.gpuAccelerationEnabled = e.target.checked;
                localStorage.setItem('2048-gpu-acceleration', gameState.gpuAccelerationEnabled);
                renderAllTiles();
            });
            elements.dataTransferButton.addEventListener('click', () => {
                showModal('data-transfer-modal');
            });
            elements.helpButton.addEventListener('click', () => {
                const modal = elements.helpModal;
                modal.classList.remove('hidden');
                modal.classList.add('modal-enter');
                setupDataTransfer();
                setTimeout(() => {
                    modal.classList.add('modal-enter-active');
                }, 10);
            });
            elements.closeHelp.addEventListener('click', () => {
                const modal = elements.helpModal;
                modal.classList.add('modal-exit-active');
                setTimeout(() => {
                    modal.classList.add('hidden');
                    modal.classList.remove('modal-exit-active', 'modal-enter', 'modal-enter-active');
                }, 300);
            });
            elements.helpModal.addEventListener('click', (e) => {
                if (e.target === elements.helpModal) {
                    const modal = elements.helpModal;
                    modal.classList.add('modal-exit-active');
                    setTimeout(() => {
                        modal.classList.add('hidden');
                        modal.classList.remove('modal-exit-active', 'modal-enter', 'modal-enter-active');
                    }, 300);
                }
            });
            elements.resetSettingsButton.addEventListener('click', resetAllSettings);
            window.addEventListener('resize', handleResize);
        }
        function loadGameState() {
            const savedState = localStorage.getItem('2048-game-state');
            const savedTheme = localStorage.getItem('2048-theme');
            if (window.themeMediaQueryListener) {
                window.themeMediaQueryListener.mediaQuery.removeEventListener('change', window.themeMediaQueryListener.handler);
                window.themeMediaQueryListener = null;
            }
            if (savedTheme === 'auto') {
                const themeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                const updateTheme = (e) => {
                    document.documentElement.classList.toggle('dark', e.matches);
                };
                themeMediaQuery.addEventListener('change', updateTheme);
                updateTheme(themeMediaQuery);
                window.themeMediaQueryListener = {
                    mediaQuery: themeMediaQuery,
                    handler: updateTheme
                };
                elements.themeToggle.value = 'auto';
            } else if (savedTheme === 'dark') {
                document.documentElement.classList.add('dark');
                elements.themeToggle.value = 'dark';
            } else {
                const themeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                const updateTheme = (e) => {
                    document.documentElement.classList.toggle('dark', e.matches);
                };
                themeMediaQuery.addEventListener('change', updateTheme);
                updateTheme(themeMediaQuery);
                window.themeMediaQueryListener = {
                    mediaQuery: themeMediaQuery,
                    handler: updateTheme
                };
                elements.themeToggle.value = 'auto';
            }
            if (savedState) {
                try {
                    const state = JSON.parse(savedState);
                    gameState.grid = state.grid || createEmptyGrid();
                    gameState.gridSize = state.gridSize || 4;
                    gameState.score = state.score || 0;
                    gameState.bestScore = state.bestScore || 0;
                    gameState.gameOver = state.gameOver || false;
                    gameState.gameWon = state.gameWon || false;
                    gameState.isEndlessMode = state.isEndlessMode || false;
                    gameState.difficulty = state.difficulty || 'medium';
                    gameState.history = state.history || [];
                    elements.scoreDisplay.textContent = gameState.score;
                    elements.bestScoreDisplay.textContent = gameState.bestScore;
                    document.querySelector('.game-container').classList.remove('grid-3x3', 'grid-4x4', 'grid-5x5');
                    document.querySelector('.game-container').classList.add(`grid-${gameState.gridSize}x${gameState.gridSize}`);
                    initGridContainer();
                    renderAllTiles();
                    updateDifficultyButtons();
                    updateGridButtonState(gameState.gridSize);
                    elements.modeDescription.textContent = gameState.isEndlessMode 
                        ? "当前模式：无尽模式 - 尽可能获得高分" 
                        : "当前模式：标准模式 - 达到2048获胜";
                    elements.difficultyDescription.textContent = `当前难度：${getDifficultyName()} - ${gameState.gridSize}×${gameState.gridSize}网格`;
                    if (gameState.gameOver) {
                        showGameMessage("游戏结束！", "无法进行任何移动。");
                    } else if (gameState.gameWon && !gameState.isEndlessMode) {
                        showGameMessage("恭喜你获胜！", "你达到了2048分，可以继续游戏挑战更高分数，或者重新开始。");
                    }
                } catch (e) {
                    console.error("Failed to load saved game state:", e);
                    initGame();
                }
            } else {
                initGame();
            }
            updateDocumentTitle();
            updateUndoButtonState();
        }
        function startGame() {
            loadGameState();
            initEventListeners();
            handleResize();
        }
        startGame();
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const customSelect = document.querySelector('.custom-select');
            const selectedValue = document.querySelector('.selected-value');
            const selectItems = document.querySelector('.select-items');
            const selectOptions = document.querySelectorAll('.select-item');
            const nativeSelect = document.getElementById('theme-toggle');
            selectedValue.textContent = nativeSelect.options[nativeSelect.selectedIndex].text; selectOptions.forEach(option => { if (option.getAttribute('data-value') === nativeSelect.value) { option.classList.add('selected'); } else { option.classList.remove('selected'); } });
            customSelect.addEventListener('click', function(e) {
                e.stopPropagation();
                const selectSelected = this.querySelector('.select-selected');
                if (selectItems.style.maxHeight) { selectItems.style.maxHeight = null; selectItems.style.opacity = '0'; selectSelected.classList.remove('active'); setTimeout(() => selectItems.classList.add('hidden'), 300); } else { selectItems.classList.remove('hidden'); selectSelected.classList.add('active'); setTimeout(() => { selectItems.style.maxHeight = "200px"; selectItems.style.opacity = '1'; }, 10); }
            });
            selectOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const value = this.getAttribute('data-value');
                    const text = this.textContent;
                    selectedValue.textContent = text;
                    nativeSelect.value = value;
                    nativeSelect.dispatchEvent(new Event('change')); selectOptions.forEach(opt => opt.classList.remove('selected')); this.classList.add('selected'); selectItems.classList.add('hidden');
                });
            });
            document.addEventListener('click', function() {
                const selectSelected = document.querySelector('.select-selected');
                if (selectItems.style.maxHeight) {
                    selectItems.style.maxHeight = null;
                    selectItems.style.opacity = '0';
                    selectSelected.classList.remove('active');
                    setTimeout(() => selectItems.classList.add('hidden'), 300);
                }
            });
            nativeSelect.addEventListener('change', function() {
                selectedValue.textContent = this.options[this.selectedIndex].text;
            });
        });
    </script>
        <div id="ai-analysis-modal" class="ai-analysis-modal hidden"><div class="ai-analysis-content"><div class="ai-analysis-title">AI游戏分析<button id="close-ai-modal" class="text-secondary/60 hover:text-secondary focus:outline-none absolute top-0 right-4 text-xl dark:text-dark-muted dark:hover:text-white" title="关闭AI分析"><i class="fa-solid fa-times"></i></button></div><div class="analysis-item"><div class="analysis-label">当前最佳移动方向</div><div id="best-move-direction" class="analysis-value best-move">向上</div></div><div class="analysis-item"><div class="analysis-label">潜在合并机会</div><div id="merge-opportunities" class="analysis-value">2处 (右侧和下方)</div></div><div class="analysis-item"><div class="analysis-label">游戏状态评估</div><div id="game-state-assessment" class="analysis-value">良好</div></div><div class="analysis-item"><div class="analysis-label">得分潜力分析</div><div id="score-potential" class="analysis-value">高 (预计可合并2个2048方块)</div></div></div></div><script>function analyzeGameState() {const directions = ['up', 'down', 'left', 'right'];const directionNames = {up: '向上', down: '向下', left: '向左', right: '向右'};let bestScore = -1;let bestDirection = 'up';let mergeOpportunities = 0;const gridCopy = JSON.parse(JSON.stringify(gameState.grid));const originalScore = gameState.score;directions.forEach(direction => {const simulatedState = {grid: JSON.parse(JSON.stringify(gridCopy)),score: originalScore,gridSize: gameState.gridSize};if (simulateMove(simulatedState, direction)) {const scoreDiff = simulatedState.score - originalScore;if (scoreDiff > bestScore) {bestScore = scoreDiff;bestDirection = direction;}}});mergeOpportunities = countMergeOpportunities(gridCopy);const emptyCells = countEmptyCells(gridCopy);let gameStateAssessment = '良好';if (emptyCells < 3) gameStateAssessment = '危险';else if (emptyCells < 6) gameStateAssessment = '一般';let scorePotential = '低';if (mergeOpportunities >= 3) scorePotential = '高';else if (mergeOpportunities >= 1) scorePotential = '中';document.getElementById('best-move-direction').textContent = directionNames[bestDirection];
            const mergeOpportunitiesElement = document.getElementById('merge-opportunities');
            mergeOpportunitiesElement.textContent = `${mergeOpportunities}处`;
            mergeOpportunitiesElement.className = 'analysis-value';
            if (mergeOpportunities >= 3) {
                mergeOpportunitiesElement.classList.add('high');
            } else if (mergeOpportunities >= 1) {
                mergeOpportunitiesElement.classList.add('medium');
            } else {
                mergeOpportunitiesElement.classList.add('low');
            }
            const gameStateElement = document.getElementById('game-state-assessment');
            gameStateElement.textContent = gameStateAssessment;
            gameStateElement.className = 'analysis-value';
            if (gameStateAssessment === '良好') {
                gameStateElement.classList.add('good');
            } else if (gameStateAssessment === '一般') {
                gameStateElement.classList.add('average');
            } else {
                gameStateElement.classList.add('danger');
            }
            const scorePotentialElement = document.getElementById('score-potential');
            scorePotentialElement.textContent = `${scorePotential} (${scorePotential === '高' ? '预计可合并多个高价值方块' : scorePotential === '中' ? '有一定合并机会' : '合并机会有限'})`;
            scorePotentialElement.className = 'analysis-value';
            if (scorePotential === '高') {
                scorePotentialElement.classList.add('high');
            } else if (scorePotential === '中') {
                scorePotentialElement.classList.add('medium');
            } else {
                scorePotentialElement.classList.add('low');
            }document.getElementById('ai-analysis-modal').classList.remove('hidden');}function simulateMove(state, direction) {let moved = false;state.grid = JSON.parse(JSON.stringify(state.grid));for (let y = 0; y < state.gridSize; y++) {for (let x = 0; x < state.gridSize; x++) {if (state.grid[y][x]) {state.grid[y][x].merged = false;}}}switch (direction) {case 'up':for (let x = 0; x < state.gridSize; x++) {for (let y = 1; y < state.gridSize; y++) {if (state.grid[y][x]) {let newY = y;while (newY > 0 && state.grid[newY - 1][x] === null) newY--;if (newY > 0 && state.grid[newY - 1][x] && state.grid[newY - 1][x].value === state.grid[y][x].value && !state.grid[newY - 1][x].merged) {state.grid[newY - 1][x].value *= 2;state.grid[newY - 1][x].merged = true;state.grid[y][x] = null;state.score += state.grid[newY - 1][x].value;moved = true;} else if (newY !== y) {state.grid[newY][x] = state.grid[y][x];state.grid[y][x] = null;moved = true;}}}}break;case 'down':for (let x = 0; x < state.gridSize; x++) {for (let y = state.gridSize - 2; y >= 0; y--) {if (state.grid[y][x]) {let newY = y;while (newY < state.gridSize - 1 && state.grid[newY + 1][x] === null) newY++;if (newY < state.gridSize - 1 && state.grid[newY + 1][x] && state.grid[newY + 1][x].value === state.grid[y][x].value && !state.grid[newY + 1][x].merged) {state.grid[newY + 1][x].value *= 2;state.grid[newY + 1][x].merged = true;state.grid[y][x] = null;state.score += state.grid[newY + 1][x].value;moved = true;} else if (newY !== y) {state.grid[newY][x] = state.grid[y][x];state.grid[y][x] = null;moved = true;}}}}break;case 'left':for (let y = 0; y < state.gridSize; y++) {for (let x = 1; x < state.gridSize; x++) {if (state.grid[y][x]) {let newX = x;while (newX > 0 && state.grid[y][newX - 1] === null) newX--;if (newX > 0 && state.grid[y][newX - 1] && state.grid[y][newX - 1].value === state.grid[y][x].value && !state.grid[y][newX - 1].merged) {state.grid[y][newX - 1].value *= 2;state.grid[y][newX - 1].merged = true;state.grid[y][x] = null;state.score += state.grid[y][newX - 1].value;moved = true;} else if (newX !== x) {state.grid[y][newX] = state.grid[y][x];state.grid[y][x] = null;moved = true;}}}}break;case 'right':for (let y = 0; y < state.gridSize; y++) {for (let x = state.gridSize - 2; x >= 0; x--) {if (state.grid[y][x]) {let newX = x;while (newX < state.gridSize - 1 && state.grid[y][newX + 1] === null) newX++;if (newX < state.gridSize - 1 && state.grid[y][newX + 1] && state.grid[y][newX + 1].value === state.grid[y][x].value && !state.grid[y][newX + 1].merged) {state.grid[y][newX + 1].value *= 2;state.grid[y][newX + 1].merged = true;state.grid[y][x] = null;state.score += state.grid[y][newX + 1].value;moved = true;} else if (newX !== x) {state.grid[y][newX] = state.grid[y][x];state.grid[y][x] = null;moved = true;}}}}}return moved;}function countMergeOpportunities(grid) {let count = 0;const size = grid.length;for (let y = 0; y < size; y++) {for (let x = 0; x < size; x++) {if (grid[y][x]) {if (x < size - 1 && grid[y][x + 1] && grid[y][x].value === grid[y][x + 1].value) count++;if (y < size - 1 && grid[y + 1][x] && grid[y][x].value === grid[y + 1][x].value) count++;}}}return count;}function countEmptyCells(grid) {let count = 0;for (let y = 0; y < grid.length; y++) {for (let x = 0; x < grid[y].length; x++) {if (!grid[y][x]) count++;}}return count;}document.getElementById('ai-analysis-button').addEventListener('click', analyzeGameState);
        document.getElementById('close-ai-modal').addEventListener('click', function() {
            document.getElementById('ai-analysis-modal').classList.add('hidden');
        });
        document.getElementById('ai-analysis-modal').addEventListener('click', function(e) {if (e.target === this) this.classList.add('hidden');});
    </script>
</body>
</html>